# Set folding to markers for .vimrc only 
# vim: foldmethod=marker

# IMAP {{{
set imap_user = "johngodlee@gmail.com"

## Call pass from within 
set my_pass = "`pass email/johngodlee@gmail.com`" 
set imap_pass = $my_pass

set from = "johngodlee@gmail.com"
set realname = "John Godlee"

set folder = "~/.mail/johngodlee@gmail.com"
set spoolfile = +INBOX
set postponed = +drafts
set record = +sent

## Don't automatically move messages after reading
set move = no

## Max time mutt should wait before polling IMAP connections, in minutes
set imap_keepalive = 30  

## Set smtp URL for replying 
set smtp_url = "smtp://johngodlee@smtp.gmail.com:587/"

## Set the login method for smtp replying
set smtp_pass = $my_pass
set smtp_authenticators = 'login'
## Allow mutt to open new imap connections to test for new mail 
unset imap_passive

## Set cache locations so IMAP polling is quicker on startup
set header_cache = ~/.mutt/johngodlee/headers
set message_cachedir = ~/.mutt/johngodlee/bodies
set certificate_file = ~/.mutt/certificates

## If stuck in a prompt, abort after n minutes to check IMAP (timeout), n minutes between checks (mail_check)
set timeout = 10
set mail_check = 5

# }}}

# Pager View Options {{{
set pager_index_lines = 0  # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs

# }}}

# Sidebar {{{
## Mailboxes to display in sidebar and check regularly 
mailboxes +INBOX +'starred' +'trash' +'drafts' +'sent' +'Archived' +'coding_club' +'diss_manuscript' +'personal' +'PhD' +'SEOSAW_contacts' +'SEOSAW_logos' +'STEB_2018' +'urgent' +'hemi_lens_proposal' +kew_taxonomy_course +'angola_botanic_garden'

## Sort sidebar folders alphabetically
set sidebar_sort_method = name

## Sidebar visible by default
set sidebar_visible = yes

## Don't abbreviate folders in sidebar
set sidebar_short_path = no

# }}}

# Statusbar {{{
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# }}}

# Index format {{{

set date_format = "%Y_%m_%d"
set index_format="%XAtt - %Z [%d] %-28.28F -- %s"

# }}}

# Address book {{{
set alias_file = "~/.mutt/aliases"
set sort_alias = alias
set reverse_alias = yes
source $alias_file

# }}}

# General settings {{{
# Edit with vim
set editor =  'vim -u ~/.vimrc_alpine'

# Always include original message in reply and always reply to sender
set include = yes
set fast_reply

# Ask if unsent message should be kept as postponed
set postpone = ask-yes

# Read in plain text if possible
alternative_order text/plain text/html
auto_view text/html
set mailcap_path = ~/.mailcap

# Enforce encoding in utf8
set send_charset="utf-8"

# Forwarding subject line format
set forward_format = "Fwd: %s"

# Smart word wrap
set smart_wrap

# New mail command to use terminal-notifier
set new_mail_command="terminal-notifier -title '%v' -subtitle 'New Mail in %f' -message '%n new messages, %u unread.' -activate 'com.apple.Terminal' &"

# }}}

# Keymappings {{{ 

## Disable arrow keys
bind generic,pager,editor,index <Up>       noop
bind generic,pager,editor,index <Down>     noop
bind generic,pager,editor,index <Left>     noop
bind generic,pager,editor,index <Right>    noop

## Tagging and manipulating basics
bind  index,pager c  mail                      # compose
bind  generic     x  tag-entry                 # Select Conversation
bind  index       x  tag-thread                # Select Conversation
bind  pager       x  tag-message               # Select Conversation
bind  index,pager *  flag-message              # Star a message 
bind  index,pager a  group-reply               # Reply all
bind  index,pager \# delete-thread             # Delete
bind  index,pager l  copy-message              # Label
bind  index       v  save-message              # Move to

## Sidebar interaction
bind  index,pager B  sidebar-toggle-visible
bind  index,pager >  sidebar-next
bind  index,pager <  sidebar-prev
bind  index,pager ?  sidebar-open

## Movement 
bind  index  G  last-entry
bind  index  j  next-entry
bind  index  k  previous-entry
bind  pager  k  previous-line
bind  pager  j  next-line
bind  pager  J  next-entry
bind  pager  K  previous-entry 
bind  pager  i  exit
bind  pager  v  view-attachments


## Fast movement
bind editor <space> noop
bind  index,pager g noop
macro index,pager gi "<change-folder>=INBOX<enter>" "Go to inbox"
macro index gs "<change-folder>=[Google Mail]/Starred<enter>" "Go to starred messages"
macro index gd "<change-folder>=[Google Mail]/Drafts<enter>" "Go to drafts"

bind  index,pager h  help

# }}}

# Colours {{{

# Use the background colour of the terminal for mutt background
color index default default ~P

# Colour folders with new mail yellow
color sidebar_new yellow default

# }}}

# notmuch {{{

set virtual_spoolfile = yes   
set nm_default_uri = "notmuch:///Users/johngodlee/.mail/johngodlee@gmail.com"
macro index,pager \\  "<vfolder-from-query>"  

# }}}
